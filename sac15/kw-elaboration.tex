\begin{figure*}[ht]
\flyingbox{$\rho \sim(\Theta;\Delta) \rightsquigarrow i:\tau$}
\vspace{-15px}
\begin{center}
\AXC{$\vdash_{\Theta_{0}}^{\emptyset}\theta\sim(\Theta;\Delta)$ ~~~~ $\emptyset\vdash_{\Theta_0\Theta}^{\Delta}e\rightsquigarrow i\Rightarrow \tau$}      \RightLabel{(compile)}
\UIC{$\theta;e\sim(\Theta;\Delta)\rightsquigarrow i:\tau$}
\DP
\end{center}



\flyingbox{$\vdash_{\Theta}^{\Delta}\theta\sim (\Theta;\Delta)$}
\vspace{-15px}
\begin{center}
\AXC{}\RightLabel{(ctx-empty)}
\UIC{$\vdash_{\Theta}^{\Delta} \emptyset \sim (\emptyset;\emptyset)$}
\DP
\end{center}

\begin{center}
\AXC{$\Theta_0 \subset\Theta$ ~~~~ $\vdash_{\Theta}^{\Delta} \theta'\sim(\Theta';\Delta')$ ~~~~ $\nexists~k.(k[\mathbf{ty}(\_,\_)]\in\Delta\Delta')$ ~~~~ $\vdash_{\Theta\Theta'}^{\Delta\Delta'}e\rightsquigarrow i\Leftarrow \mathbf{named}[TypeTSM]$ ~~~~ $\vdash_{\Theta\Theta'}\tau$}
\RightLabel{(ctx-tytsm)}
\UIC{$\vdash_{\Theta}^{\Delta} \theta';k[\mathbf{ty}(e, \tau)] \sim (\Theta';\Delta',k[\mathbf{ty}(i, \tau)])$}
\DP
\end{center}

\begin{center}
\AXC
{
	$\Theta_{0}\subset\Theta$ ~~~~ $\vdash_{\Theta}^{\Delta}\theta' \sim (\Theta';\Delta')$ ~~~~ $T\notin {dom}(\Theta\Theta')$ ~~~~ $\vdash_{\Theta\Theta',T[?,?]}\tau$ ~~~~ $\emptyset\vdash_{\Theta\Theta',T[\tau,?]}^{\Delta\Delta'}e\rightsquigarrow i_m\Rightarrow\tau_m$
}\RightLabel{(ctx-explicit-type)}
\UIC{$\vdash_{\Theta}^{\Delta} \theta';T[\mathbf{explicit}(\tau,e_m)] \sim (\Theta',T[\tau,i_m:\tau_m];\Delta')$}
\DP
\end{center}

\begin{center}
\AXC{
	\stackanchor{
		\stackanchor{$\Theta_0\subset\Theta$ ~~~~ $\vdash_{\Theta}\theta' \sim (\Theta';\Delta')$ ~~~~ $T\notin {dom}(\Theta\Theta')$ ~~~~ $k[\mathbf{ty}(i_k,\tau_m)]\in\Delta\Delta'$}
		{$\mathsf{parsestream}(body)=i_{ps}$ ~~~~ $\mathbf{iap}(\mathbf{iprj}[parse](i_k);i_{ps})\Downarrow \mathbf{iinj}[OK]((i_{type},i_{m},i'_{ps}))$}
	}
	{$i_{type}\uparrow\tau$ ~~~~ $\vdash_{\Theta\Theta',T[?,?]}\tau$ ~~~~ $\emptyset\vdash_{\Theta\Theta',T[\tau,?]}^{\Delta\Delta'}e_m\rightsquigarrow i_m' \Rightarrow \mathbf{arrow}[\tau_m, \tau'_m]$ ~~~~ $\mathbf{iap}(i_m';i_m)\Downarrow i''_m$}
}
\RightLabel{(ctx-tsmap-type)}
\UIC{$\myvdash \theta';T[\mathbf{tsmap}(k,body,e_m)] \sim (\Theta',T[\tau,i''_m:\tau'_m];\Delta')$}
\DP
\end{center}

\begin{center}
%\AXC{$\Theta_0\subset \Theta$ ~~~~ $\myvdash \theta'\rightsquigarrow\Theta'$ ~~~~ $k\notin dom(\Theta\Theta')$ ~~~~ $\emptyset\vdash_{\Theta\Theta'} e_{k}\rightsquigarrow i_{k}\Leftarrow \mathbf{named}[ExpKw]$}								\RightLabel{(expkw-wk)}
\AXC{
	\stackanchor
	{$\Theta_0\subset \Theta$ ~~~~ $\myvdash \theta'\sim(\Theta';\Delta')$ ~~~~ $\nexists~k.(k[\mathbf{ana}(\_)]\in \Delta\Delta'\lor k[\mathbf{syn}(\_,\_)]\in\Delta\Delta')$}
	{$\emptyset\vdash_{\Theta\Theta'}^{\Delta\Delta'} e_{k}\rightsquigarrow i_{k}\Leftarrow \mathbf{named}[TermTSM]$}
}\RightLabel{(ctx-anatsm)}
\UIC{$\myvdash\theta';k[\mathbf{ana}(e_k)]\sim (\Theta';\Delta,k[\mathbf{ana}(i_k)])$}
\DP
\end{center}

\begin{center}
\AXC{
	\stackanchor
	{$\Theta_0\subset \Theta$ ~~~~ $\myvdash \theta'\sim(\Theta';\Delta')$ ~~~~ $\nexists~k.(k[\mathbf{ana}(\_)]\in \Delta\Delta'\lor k[\mathbf{syn}(\_,\_)]\in\Delta\Delta')$}
	{$\vdash_{\Theta\Theta'} \tau$ ~~~~ $\emptyset\vdash_{\Theta\Theta'}^{\Delta\Delta'} e_{k}\rightsquigarrow i_{k}\Leftarrow \mathbf{named}[TermTSM]$}
}\RightLabel{(ctx-syntsm)}
\UIC{$\myvdash\theta';k[\mathbf{syn}(\tau,e_k)]\sim (\Theta';\Delta',k[\mathbf{syn}(\tau,i_k)])$}
\DP
\end{center}

\caption{Typechecking and elaboration of programs}
\label{typechecking-elaboration}
\end{figure*}
