\begin{figure*}[ht]
\flyingbox{$\rho \sim \Delta\sim \Theta\sim\Psi\rightsquigarrow i:\tau$}
\vspace{-15px}
\begin{center}
\AXC{$\vdash_{\Theta_{0}}\eta \sim \Delta$ ~~~~ $\vdash_{\Theta_{0}}^{\Delta;\emptyset}\theta\sim\Theta$ ~~~~ $\vdash_{\Theta_0\Theta}^{\Delta;\emptyset}\kappa\sim\Psi $ ~~~~ $\emptyset\vdash_{\Theta_0\Theta}^{\Delta;\Psi}e\rightsquigarrow i\Rightarrow \tau$}      \RightLabel{(compile)}
\UIC{$\eta;\theta;\kappa;e\sim\Delta\sim\Theta\sim\Psi\rightsquigarrow i:\tau$}
\DP
\end{center}

\flyingbox{$\vdash_{\Theta}\eta\sim\Delta$}
\vspace{-15px}
\begin{center}
\AXC{}%\RightLabel{~(tykw-empty)}
\UIC{$\vdash_{\Theta} \emptyset\sim\emptyset$}
\AXC{$\Theta_0 \subset\Theta$ ~~~~ $\vdash_\Theta \eta\sim\Delta$ ~~~~ $k\notin dom(\Delta)$ ~~~~ $\vdash_{\Theta}^{\emptyset;\emptyset}e\rightsquigarrow i\Leftarrow \mathbf{named}[TypeKw]$ ~~~~ $\vdash_{\Theta}\tau$}
\RightLabel{~(tykw-c)}
\UIC{$\vdash_{\Theta} \eta;k[\mathbf{ty},e, \tau] \sim \Delta;k[\mathbf{ty},i, \tau]$}
\noLine
\BIC{}
\DP
\end{center}

\flyingbox{$\vdash_{\Theta}^{\Delta;\Psi}\theta\sim \Theta$}
\vspace{-15px}
\begin{center}
\AXC{}\RightLabel{~ (ctx-empty)}
\UIC{${\vdash_{\Theta}^{\Delta;\Psi}} \emptyset \sim \emptyset$}
\DP
\end{center}

\begin{center}
\AXC
{
	$\Theta_{0}\subset\Theta$ ~~~~ $\vdash_{\Theta}^{\Delta;\Psi}\theta' \sim \Theta'$ ~~~~ $T\notin {dom}(\Theta\Theta')$ ~~~~ $\vdash_{\Theta\Theta',T[?,?]}\tau$ ~~~~ $\emptyset\vdash_{\Theta\Theta',T[\tau,?]}^{\Delta;\Psi}e\rightsquigarrow i_m\Rightarrow\tau_m$
}\RightLabel{~ (ctx-explicit-type)}
\UIC{${\vdash^{\Delta}_{\Theta}} \theta';T[\mathbf{explicit},\tau,e_m] \sim \Theta',T[\tau,i_m:\tau_m]$}
\DP
\end{center}
\vspace{3pt}

\begin{center}
\AXC{
	\stackanchor{
		\stackanchor{$\Theta_0\subset\Theta$ ~~~~ $\vdash_{\Theta}^{\Delta;\Psi}\theta' \sim \Theta'$ ~~~~ $T\notin {dom}(\Theta\Theta')$ ~~~~ $k[\mathbf{ty},i_k,\tau_m]\in\Delta$}
		{$\texttt{parsestream}(body)=i_{ps}$ ~~~~ $\mathbf{iap}(\mathbf{iprj}[parse](i_k);i_{ps})\Downarrow \mathbf{iinj}[OK]((i_{type},i_{m},i'_{ps}))$}
	}
	{$i_{type}\uparrow\tau$ ~~~~ $\vdash_{\Theta\Theta',T[?,?]}\tau$ ~~~~ $\emptyset\vdash_{\Theta\Theta',T[\tau,?]}^{\Delta;\Psi}e_m\rightsquigarrow i_m' \Rightarrow \mathbf{arrow}[\tau_m, \tau'_m]$ ~~~~ $\mathbf{iap}(i_m';i_m)\Downarrow i''_m$}
}
\RightLabel{~ (ctx-typekw-type)}
\UIC{$\myvdash \theta';T[\mathbf{tykw},k,body,e_m] \sim \Theta',T[\tau,i''_m:\tau'_m]$}
\DP
\end{center}

\flyingbox{$\myvdash \kappa\rightsquigarrow \Psi$}
\vspace{-15px}
\begin{center}
\AXC{}
\UIC{$\myvdash \emptyset \sim \emptyset$}
%%%
\AXC{$\Theta_0\subset \Theta$ ~~~~ $\myvdash \kappa'\rightsquigarrow\Psi'$ ~~~~ $k\notin dom(\Psi\Psi')$ ~~~~ $\emptyset\vdash_{\Theta}^{\Delta;\Psi\Psi'} e_{k}\rightsquigarrow i_{k}\Leftarrow \mathbf{named}[ExpKw]$}								\RightLabel{(expkw-wk)}
\UIC{$\myvdash\kappa';k[\mathbf{wk},e_k]\rightsquigarrow \Psi';k[\mathbf{wk},i_k]$}
\noLine
\BIC{}
\DP
\end{center}

\begin{center}
\AXC{$\Theta_0\subset \Theta$ ~~~~ $\myvdash \kappa'\rightsquigarrow\Psi'$ ~~~~ $k\notin dom(\Psi\Psi')$ ~~~~ $\vdash_{\Theta} \tau$ ~~~~ $\emptyset\vdash_{\Theta}^{\Delta;\Psi\Psi'} e_{k}\rightsquigarrow i_{k}\Leftarrow \mathbf{named}[ExpKw]$}	\RightLabel{(expkw-bk)}
\UIC{$\myvdash\kappa';k[\mathbf{bk}(\tau),e_k]\rightsquigarrow \Psi';k[\mathbf{bk}(\tau),i_k]$}
\DP
\end{center}

\caption{Typechecking and elaboration of programs}
\label{typechecking-elaboration}
\end{figure*}
