\begin{figure*}[ht]
\flyingbox{$\rho \sim\Theta \rightsquigarrow i:\tau$}
\vspace{-15px}
\begin{center}
\AXC{$\vdash_{\Theta_{0}}\theta\sim\Theta$ ~~~~ $\emptyset\vdash_{\Theta_0\Theta}e\rightsquigarrow i\Rightarrow \tau$}      \RightLabel{(compile)}
\UIC{$\theta;e\sim\Theta\rightsquigarrow i:\tau$}
\DP
\end{center}



\flyingbox{$\vdash_{\Theta}\theta\sim \Theta$}
\vspace{-15px}
\begin{center}
\AXC{}\RightLabel{(ctx-empty)}
\UIC{${\vdash_{\Theta}} \emptyset \sim \emptyset$}
\DP
\end{center}

\begin{center}
\AXC{$\Theta_0 \subset\Theta$ ~~~~ $\vdash_\Theta \theta'\sim\Theta'$ ~~~~ $\nexists~k.(k[\mathbf{ty},\_,\_]\in\Theta\Theta')$ ~~~~ $\vdash_{\Theta\Theta'}e\rightsquigarrow i\Leftarrow \mathbf{named}[TypeKw]$ ~~~~ $\vdash_{\Theta\Theta'}\tau$}
\RightLabel{(tykw-c)}
\UIC{$\vdash_{\Theta} \theta';k[\mathbf{ty},e, \tau] \sim \Theta';k[\mathbf{ty},i, \tau]$}
\DP
\end{center}

\begin{center}
\AXC
{
	$\Theta_{0}\subset\Theta$ ~~~~ $\vdash_{\Theta}\theta' \sim \Theta'$ ~~~~ $T\notin {dom}(\Theta\Theta')$ ~~~~ $\vdash_{\Theta\Theta',T[?,?]}\tau$ ~~~~ $\emptyset\vdash_{\Theta\Theta',T[\tau,?]}e\rightsquigarrow i_m\Rightarrow\tau_m$
}\RightLabel{(ctx-explicit-type)}
\UIC{${\vdash_{\Theta}} \theta';T[\mathbf{explicit},\tau,e_m] \sim \Theta',T[\tau,i_m:\tau_m]$}
\DP
\end{center}
\vspace{3pt}

\begin{center}
\AXC{
	\stackanchor{
		\stackanchor{$\Theta_0\subset\Theta$ ~~~~ $\vdash_{\Theta}\theta' \sim \Theta'$ ~~~~ $T\notin {dom}(\Theta\Theta')$ ~~~~ $k[\mathbf{ty},i_k,\tau_m]\in\Theta$}
		{$\mathsf{parsestream}(body)=i_{ps}$ ~~~~ $\mathbf{iap}(\mathbf{iprj}[parse](i_k);i_{ps})\Downarrow \mathbf{iinj}[OK]((i_{type},i_{m},i'_{ps}))$}
	}
	{$i_{type}\uparrow\tau$ ~~~~ $\vdash_{\Theta\Theta',T[?,?]}\tau$ ~~~~ $\emptyset\vdash_{\Theta\Theta',T[\tau,?]}e_m\rightsquigarrow i_m' \Rightarrow \mathbf{arrow}[\tau_m, \tau'_m]$ ~~~~ $\mathbf{iap}(i_m';i_m)\Downarrow i''_m$}
}
\RightLabel{(ctx-typekw-type)}
\UIC{$\myvdash \theta';T[\mathbf{tykw},k,body,e_m] \sim \Theta',T[\tau,i''_m:\tau'_m]$}
\DP
\end{center}

\begin{center}
%\AXC{$\Theta_0\subset \Theta$ ~~~~ $\myvdash \theta'\rightsquigarrow\Theta'$ ~~~~ $k\notin dom(\Theta\Theta')$ ~~~~ $\emptyset\vdash_{\Theta\Theta'} e_{k}\rightsquigarrow i_{k}\Leftarrow \mathbf{named}[ExpKw]$}								\RightLabel{(expkw-wk)}
\AXC{
	\stackanchor
	{$\Theta_0\subset \Theta$ ~~~~ $\myvdash \theta'\rightsquigarrow\Theta'$ ~~~~ $\nexists~k.(k[\mathbf{wk},\_]\in \Theta\Theta'\lor k[\mathbf{bk}(\_),\_]\in\Theta\Theta')$}
	{$\emptyset\vdash_{\Theta\Theta'} e_{k}\rightsquigarrow i_{k}\Leftarrow \mathbf{named}[ExpKw]$}
}\RightLabel{(expkw-wk)}
\UIC{$\myvdash\theta';k[\mathbf{wk},e_k]\rightsquigarrow \Theta';k[\mathbf{wk},i_k]$}
\DP
\end{center}

\begin{center}
\AXC{
	\stackanchor
	{$\Theta_0\subset \Theta$ ~~~~ $\myvdash \theta'\rightsquigarrow\Theta'$ ~~~~ $\nexists~k.(k[\mathbf{wk},\_]\in \Theta\Theta'\lor k[\mathbf{bk}(\_),\_]\in\Theta\Theta')$}
	{$\vdash_{\Theta} \tau$ ~~~~ $\emptyset\vdash_{\Theta\Theta'} e_{k}\rightsquigarrow i_{k}\Leftarrow \mathbf{named}[ExpKw]$}
}\RightLabel{(expkw-bk)}
\UIC{$\myvdash\theta';k[\mathbf{bk}(\tau),e_k]\rightsquigarrow \Theta';k[\mathbf{bk}(\tau),i_k]$}
\DP
\end{center}

\caption{Typechecking and elaboration of programs}
\label{typechecking-elaboration}
\end{figure*}
