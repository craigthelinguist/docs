% !TEX root = ecoop14.tex

\begin{figure}
\begin{lstlisting}[mathescape]
(* programs *)
p $\rightarrow$ 'objtype'$^=$ ID$^>$ NEWLINE$^>$ objdecls$^>$ NEWLINE$^>$ metadatadecl$^>$ NEWLINE$^>$ p$^=$
p $\rightarrow$ 'casetype'$^=$ ID$^>$ NEWLINE$^>$ casedecls$^>$ NEWLINE$^>$ metadatadecl$^>$ NEWLINE$^>$ p$^=$
p $\rightarrow$ e$^=$

metadatadecl $\rightarrow$ 'metadata'$^=$ '='$^>$ e$^>$

(* expressions *)
e $\rightarrow$ $\overline{\texttt{e}}$$^=$
e $\rightarrow$ $\widetilde{\texttt{e}}$['~']$^=$ NEWLINE$^>$ chars$^>$
e $\rightarrow$ $\widetilde{\texttt{e}}$['new']$^=$ NEWLINE$^>$ d$^>$
e $\rightarrow$ $\widetilde{\texttt{e}}$['case(' $\overline{\texttt{e}}$ ')']$^=$ NEWLINE$^>$ c$^>$

(* object definitions *)
d $\rightarrow$ $\varepsilon$
d $\rightarrow$ 'val'$^=$ ID$^>$ ':'$^>$ type$^>$ '='$^>$ e$^>$ NEWLINE$^>$ d$^=$
d $\rightarrow$ 'def'$^=$ ID$^>$ '('$^>$ argsig$^>$ ')'$^>$ ':'$^>$ type$^>$ '='$^>$ e$^>$ NEWLINE$^>$ d$^=$

(* cases *)
c $\rightarrow$ cc | cp
cc $\rightarrow$ ID$^=$ '('$^>$ ID$^>$ ')'$^>$ '=>'$^>$ e$^>$
cc $\rightarrow$ ID$^=$ '('$^>$ ID$^>$ ')'$^>$ '=>'$^>$ e$^>$ NEWLINE$^>$ cs$^=$
cp $\rightarrow$ '('$^=$ ID$^>$ ','$^>$ ID$^>$ ')'$^>$ '=>'$^>$ e$^>$

(* expressions not containing forward references *)
$\overline{\texttt{e}}$ $\rightarrow$ ID$^=$
$\overline{\texttt{e}}$ $\rightarrow$ 'fn'$^=$ ID$^>$ ':'$^>$ type$^>$ '=>'$^>$ $\overline{\texttt{e}}$$^>$
$\overline{\texttt{e}}$ $\rightarrow$ $\overline{\texttt{e}}$$^=$ '('$^>$ $\overline{\texttt{al}}$$^>$ ')'$^>$
$\overline{\texttt{e}}$ $\rightarrow$ '('$^=$ $\overline{\texttt{e}}$$^>$ ','$^>$ $\overline{\texttt{e}}$$^>$ ')'$^>$
$\overline{\texttt{e}}$ $\rightarrow$ 'let'$^=$ ID$^>$ ':'$^>$ type$^>$ '='$^>$ e$^>$ NEWLINE$^>$ $\overline{\texttt{e}}$$^=$
$\overline{\texttt{e}}$ $\rightarrow$ $\overline{\texttt{e}}$$^=$ '.'$^>$ ID$^>$
$\overline{\texttt{e}}$ $\rightarrow$ type$^=$ '.'$^>$ ID$^>$ '('$^>$ $\overline{\texttt{e}}$$^>$ ')'$^>$
$\overline{\texttt{e}}$ $\rightarrow$ $\overline{\texttt{e}}$$^=$ ':'$^>$ type$^>$
$\overline{\texttt{e}}$ $\rightarrow$ 'valAST'$^=$ '('$^>$ $\overline{\texttt{e}}$$^>$ ')'$^>$
$\overline{\texttt{e}}$ $\rightarrow$ type$^=$ '.'$^>$ 'metadata'$^>$
$\overline{\texttt{e}}$ $\rightarrow$ inlinelit$^=$

$\overline{\texttt{al}}$ $\rightarrow$ $\varepsilon$ | $\overline{\texttt{al}}_{\texttt{nonempty}}$$^=$
$\overline{\texttt{al}}_{\texttt{nonempty}}$ $\rightarrow$ $\overline{\texttt{e}}$$^=$ | $\overline{\texttt{e}}$$^=$ ','$^>$ $\overline{\texttt{al}}_{\texttt{nonempty}}$$^>$

inlinelit $\rightarrow$ chars1['`']$^=$ | chars1[''']$^=$ | chars1['"']$^=$ | ...
inlinelit $\rightarrow$ chars2['{', '}']$^=$ | chars2['<', '>']$^=$ | chars2['[', ']']$^=$ | ...
inlinelit $\rightarrow$ numlit$^=$

(* expressions containing exactly one forward reference *)
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ fwd$^=$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ 'fn'$^=$ ID$^>$ ':'$^>$ type$^>$ '=>'$^>$ $\widetilde{\texttt{e}}$[fwd]$^>$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ $\widetilde{\texttt{e}}$[fwd]$^=$ '('$^>$ $\overline{\texttt{al}}$$^>$ ')'$^>$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ '('$^=$ $\overline{\texttt{e}}$$^>$ ','$^>$ $\widetilde{\texttt{e}}$[fwd]$^>$ ')'$^>$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ '('$^=$ $\widetilde{\texttt{e}}$[fwd]$^>$ ','$^>$ $\overline{\texttt{e}}$$^>$ ')'$^>$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ 'let'$^=$ ID$^>$ ':'$^>$ type$^>$ '='$^>$ e$^>$ NEWLINE$^>$ $\widetilde{\texttt{e}}$[fwd]$^=$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ $\overline{\texttt{e}}$$^=$ '('$^>$ $\widetilde{\texttt{al}}$[fwd]$^>$ ')'$^>$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ $\widetilde{\texttt{e}}$[fwd]$^=$ '.'$^>$ ID$^>$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ type$^=$ '.'$^>$ ID$^>$ '('$^>$ $\widetilde{\texttt{e}}$[fwd]$^>$ ')'$^>$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ $\widetilde{\texttt{e}}$[fwd]$^=$ ':'$^>$ type$^>$
$\widetilde{\texttt{e}}$[fwd] $\rightarrow$ 'valAST'$^=$ '('$^>$ $\widetilde{\texttt{e}}$[fwd]$^>$ ')'$^>$

$\widetilde{\texttt{al}}$[fwd] $\rightarrow$ $\widetilde{\texttt{e}}$[fwd]$^=$
$\widetilde{\texttt{al}}$[fwd] $\rightarrow$ $\widetilde{\texttt{e}}$[fwd]$^=$ ','$^>$ $\overline{\texttt{al}}_{\texttt{nonempty}}$$^>$
$\widetilde{\texttt{al}}$[fwd] $\rightarrow$ $\overline{\texttt{e}}$$^=$ ','$^>$ $\widetilde{\texttt{al}}$[fwd]$^>$
\end{lstlisting}
\caption{Concrete Syntax}
\label{f-grammar}
\end{figure}
