% !TEX root = ecoop14.tex
\section{Statics}

\begin{figure}
\centering
\[
\begin{array}{lll}
\rho & \bnfdef & \keyw{objtype}~ t~ = \{ \omega, \keyw{metaobject}=e \}; \rho \\
     & \bnfalt & \keyw{casetype}~ t~ = \{ \chi, \keyw{metaobject}=e \}; \rho\\
     & \bnfalt & e\\
     \\[1ex]
\chi & \bnfdef & C~\keyw{of}~\tau\\
     & \bnfalt & \chi \bnfalt \chi \\
\\[1ex]
e    & \bnfdef & x \\
     & \bnfalt & \boldsymbol\lambda x{:}\tau . e \\ %
     & \bnfalt & e(e) \\
     & \bnfalt & t.C(e) \\
     & \bnfalt & \keyw{case}~e~\keyw{of}~\{ c \} \\
     & \bnfalt & \keyw{new}~ \{ d \}\\
     & \bnfalt & e.f \\
%     & \bnfalt & e.f = e \\
     & \bnfalt & e.m \\
     & \bnfalt & e : \tau\\
     & \bnfalt & t.\keyw{metaobject}\\
\\[1ex]	 
\end{array}
\begin{array}{lll}
~~~~
\end{array}
\begin{array}{lll}
\hat{e}    & \bnfdef & x \\
     & \bnfalt & \boldsymbol\lambda x{:}\tau . \hat{e} \\ %
     & \bnfalt & \hat{e}(\hat{e}) \\
     & \bnfalt & \cdots \\
     & \bnfalt & t.\keyw{metaobject}\\
     & \bnfalt & \lfloor dsl \rfloor \\
\\[1ex]
c    & \bnfdef & C(x) \Rightarrow e\\
     & \bnfalt & c \bnfalt c\\
	 \\[1ex]
d    & \bnfdef & \keyw{val}~ f:\tau = e \\
     & \bnfalt & \keyw{def}~ m:\tau = e \\
     & \bnfalt & d~d
\\[1ex]
\tau & \bnfdef & t\\
     & \bnfalt & \tau \rightarrow \tau \\
\\[1ex]
\omega   & \bnfdef & \keyw{val}~ f:\tau\\
         & \bnfalt & \keyw{def}~ m:\tau \\
         & \bnfalt & \omega~\omega 
\\[1ex]
\end{array}
\]
\caption{Featherweight Wyvern Syntax}
\label{fig:core2-syntax}
\end{figure}


\begin{figure}
\centering
\[
\begin{array}{c}

\infer[\textit{RT-objtype}]
	{\Delta; \Gamma \vdash  \keyw{objtype}~ t~=\{{\omega}, \keyw{metaobject}=e\}; \rho} 
	{\Delta \vdash \omega & \Delta; \Gamma \vdash e \uparrow\tau & \Delta, t:\{\omega,\tau\}; \Gamma \vdash \rho }\\[3ex]

\infer[\textit{RT-casetype}]
	{\Delta; \Gamma \vdash  \keyw{casetype}~ t~=\{\chi, \keyw{metaobject}=e\}; \rho} 
	{\Delta \vdash \chi & \Delta; \Gamma \vdash e \uparrow\tau & \Delta, t:\{\chi,\tau\}; \Gamma \vdash \rho  }\\[3ex]

\infer[\textit{C-decl}]
	{\Delta; \Gamma \vdash  C~\keyw{of}~\tau} 
	{\Delta \vdash \tau   }\\[3ex]

\infer[\textit{C-decls}]
	{\Delta; \Gamma \vdash  \chi_1 \bnfalt \chi_2} 
	{\Delta; \Gamma \vdash \chi_1 & \Delta; \Gamma \vdash \chi_2 & \text{dom}(\chi_1) \intersect \text{dom}(\chi_2) = \emptyset}\\[3ex]

\infer[\textit{O-val}]
	{\Delta; \Gamma \vdash \keyw{val}~ f:\tau \ \texttt{ok} }
	{\Delta \vdash \tau} \\[3ex]
	
\infer[\textit{O-def}]
	{\Delta; \Gamma \vdash \keyw{def}~ m:\tau \ \texttt{ok} }
	{\Delta \vdash \tau } \\[3ex]

\infer[\textit{O-defs}]
	{\Delta; \Gamma \vdash \omega_1\ \omega_2  }
	{\Delta \vdash \omega_1 & \Delta \vdash \omega_2 & \text{dom}(\omega_1) \intersect \text{dom}(\omega_2) = \emptyset } \\[3ex]
	
\infer[\textit{T-varx}]
	{\Delta,\Gamma \vdash x\uparrow\tau } 
	{x:\tau \in \Gamma }\\[3ex]

\infer[\textit{T-abs}]
	{\Delta; \Gamma \vdash  \boldsymbol\lambda x{:}\tau . e \uparrow \tau \rightarrow \tau_1} 
	{\Delta; \Gamma, x:\tau \vdash e\uparrow\tau_1  & \Delta\vdash \tau}\\[3ex]

\infer[\textit{T-appl}]
	{\Delta; \Gamma \vdash  e(e_1) \uparrow\tau_2} 
	{\Delta; \Gamma \vdash e \uparrow \tau_1 \rightarrow \tau_2 & \Gamma \vdash e_1 \downarrow \tau_1}\\[3ex]

\infer[\textit{T-introcase}]
	{\Delta; \Gamma \vdash  t.C(e) \uparrow t} 
	{t:\{\chi, \tau\} \in \Delta & C\ \keyw{of}\ \tau' \in \chi &\Delta; \Gamma \vdash e \downarrow \tau'}\\[3ex]

\infer[\textit{T-elimcase}]
	{\Delta; \Gamma \vdash  \keyw{case}~e~\keyw{of}~\{ c \} \uparrow\tau'} 
	{\Delta; \Gamma \vdash e \uparrow t & t:\{ \chi,\tau\} \in \Delta & c:\chi \uparrow \tau'}\\[3ex]

\infer[\textit{T-casehelper1}]
	{\Delta; \Gamma \vdash  C(\chi)\Rightarrow e : C\ \keyw{of}\ \tau \uparrow \tau'} 
	{\Delta; \Gamma, x:\tau \vdash e \uparrow \tau'}\\[3ex]

\infer[\textit{T-casehelper2}]
	{\Delta; \Gamma \vdash  c_1 \bnfalt c_2: \chi_1 \bnfalt \chi_2 \uparrow \tau' } 
	{\Delta; \Gamma \vdash c_1:\chi_1 \uparrow \tau' & \Delta; \Gamma \vdash c_2:\chi_2 \uparrow \tau'}\\[3ex]


\end{array}
\]
\caption{Static Semantics Rules Core 2}
\end{figure}

\begin{figure}
\centering
\[
\begin{array}{c}

\infer[\textit{T-new}]
	{\Delta; \Gamma \vdash \keyw{new} \{ d \} \downarrow  t }
	{ t:\{\omega,\tau\} \in \Delta & \Delta;\Gamma \vdash d \downarrow \omega} \\[3ex]


\infer[\textit{DT-val}]
	{\Delta; \Gamma \vdash \keyw{val}~ f:\tau = e \downarrow \keyw{val}~ f:\tau }
	{\Delta \vdash \tau &\Delta; \Gamma \vdash e \downarrow \tau  } \\[3ex]
	
\infer[\textit{DT-def}]
	{\Delta; \Gamma \vdash \keyw{def}~ m:\tau = e \downarrow \keyw{def}~ m:\tau }
	{\Delta \vdash \tau  & \Delta; \Gamma \vdash e  \downarrow \tau } \\[3ex]

	
\infer[\textit{DT-defs}]
	{\Delta; \Gamma \vdash d_1\ d_2 \downarrow \omega_1\ \omega_2 }
	{\Delta; \Gamma \vdash d_1 \downarrow \omega_1 &  \Delta; \Gamma \vdash d_2 \downarrow \omega_2 } \\[3ex]


\infer[\textit{T-field}]
	{\Delta; \Gamma \vdash  e.f \uparrow \tau'} 
	{\Delta; \Gamma \vdash e \uparrow t & t:\{\omega, \tau\}\in \Delta & \keyw{val}\ f:\tau' \in \omega  }\\[3ex]

 
\infer[\textit{T-def }]
	{\Delta; \Gamma \vdash  e.m \uparrow\tau'} 
	{\Delta; \Gamma \vdash e \uparrow t & t: \{\omega, \tau\} \in \Delta & \keyw{def}\ m:\tau' \in \omega }\\[3ex]

\infer[\textit{T-ascribe}]
	{\Delta; \Gamma  \vdash  e:\tau \uparrow \tau }
	{\Delta \vdash \tau & \Delta; \Gamma \vdash e \downarrow \tau } \\[3ex]


\infer[\textit{T-metaobject}]
        {\Delta; \Gamma \vdash t.\keyw{metaobject} \uparrow \tau   }
	{t:\{\_, \tau\} \in \Delta} \\[3ex]

\infer[\textit{T-dsl}]
        {\Delta; \Gamma \vdash \lfloor dsl \rfloor \downarrow \tau \leadsto e }
	{\Delta;\Gamma \vdash \tau.metaobject.parser\downarrow Parser \leadsto e_p & \text{tokenstream of} \lfloor dsl \rfloor\ \text{is}\ e_{ts}\\
 e_p.parse(e_{ts}) \Downarrow Exp.C(e') & Exp.C(e') \hookrightarrow \hat{e'} & \Delta;\Gamma\vdash \hat{e'}\downarrow t \leadsto e } \\[3ex]





\end{array}
\]
\caption{Static Semantics Rules Core 2}
\end{figure}
