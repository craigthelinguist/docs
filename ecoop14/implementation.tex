% !TEX root = ecoop14.tex

\section{Implementation}
\label{s:implementation}
The implementation of Wyvern is based around a core parsing and typechecking system, with TSL parsers being added as an an intermediate step. The top-level parser for Wyvern is produced by the Copper parser generator~\cite{van2007context}
and uses stateful LALR parsing to handle whitespace and the core language, as well as for inline TSL invocations. Forward references, such as the TSL tilde, the new keyword, and case statements, are handled using a special ``signal'' token, where the parser generates the signal if it reaches the end of an expression containing the forward reference. When the parser then encounters this signal token, it enters an appropriate state depending on the type of forward reference encountered. TSL blocks are handled as strings, preserving whitespace, and new and case statements are parsed using their respective grammars. 

Wyvern performs TSL parsing as part of its typechecker, which is otherwise a standard bidirectional typesystem implementation. When the typechecker encounters a TSL block, it retrieves the associated parser and applies it to the string produced by the first stage of parsing. These steps may then be performed recursively, if the TSL parser requires that additional Wyvern code be parsed inside itself. 

As of this writing, the implementation of the TSL parser extension mechanism is still incomplete, but does support extending Wyvern with simple TSLs such as a simple calculator language. 