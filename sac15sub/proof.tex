\documentclass{article}
\usepackage{mathpartir}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{amsmath,fullpage,amssymb}

\newcommand{\typeexample}[2]{$#1$\\$#2$}
\newcommand{\st}{\ensuremath{\hspace{-1px}<:\hspace{-1px}}}
\newcommand{\alphahat}{\hat{\alpha}}
\newcommand{\betahat}{\hat{\beta}}

\newcommand{\botbound}{\sigma_{l}}
\newcommand{\topbound}{\sigma_{u}}

\newcommand{\marker}[1]{{\scriptscriptstyle {\blacktriangleright #1}}}

\newcommand{\lub}{\ensuremath{\vee}}
\newcommand{\glb}{\ensuremath{\wedge}}

\newcommand{\siglub}{\underbar{\lub}}
\newcommand{\sigglb}{\overset{\sigma}{\glb}}


\newcommand{\instr}{\overset{<}{=:}}
\newcommand{\instl}{\overset{<}{:=}}

\newcommand{\bndr}{\instr}
\newcommand{\bndl}{\instl}

\newcommand{\sigbndl}{:<\hspace{-5px}<}
\newcommand{\sigbndr}{<\hspace{-5px}<:}

\newcommand{\siginstr}{\overset{\overline{<}}{=:}}
\newcommand{\siginstl}{\overset{\overline{<}}{:=}}

\newcommand{\ctxtsep}{;}
\newcommand{\ctxbsep}{;}

\newcommand{\tst}{{\scriptstyle{<:}}}
\newcommand{\bound}[3]{#1 \tst #2 \tst #3}

\newcommand{\analyzes}{\ensuremath{\Leftarrow}}
\newcommand{\synth}{\ensuremath{\Rightarrow}}

\newcommand{\fnSynth}{\synth\hspace{-5px}\synth}

\newcommand{\pronounce}[2]{{\makebox[\linewidth][l]{\framebox{#1} \parbox{\textwidth}{#2}}}}

\newcounter{labctr}
\newcommand{\la}[1]{\refstepcounter{labctr}\label{#1}\arabic{labctr})\>}
\newcommand{\resla}{\setcounter{labctr}{0}}

\renewcommand{\and}{\text{ and }}
\newcommand{\ctxmapto}{\longmapsto}

\newcommand{\pair}[2]{\left<#1,#2\right>}

\begin{document}

\section{Instantiation Completeness}
Bound extension:
\[
\inferrule{\Gamma \vdash \sigma_l \sigbndl \tau \dashv \Theta \\ \Gamma \vdash \tau \sigbndr \sigma_t \dashv \Theta' \\ \Theta \ctxmapto \Omega \\ \Theta' \ctxmapto \Omega}{\Gamma, \bound{\sigma_l}{\alphahat}{\sigma_t} \ctxmapto \Omega, \alphahat = \tau} 
\]


Given that $\Gamma \longmapsto \Omega$, $A=[\Gamma]A$, $\alphahat\not\in \text{FV}(A)$, and $\alphahat \in \Gamma$\\
if $[\Omega]\Gamma\vdash [\Omega]\alphahat \leq [\Omega]A$, then there are some $\Delta,\Omega'$ such that $\Delta \longmapsto \Omega'$, $\Omega \longrightarrow \Omega'$ and $\Gamma \vdash \alphahat \instl A \dashv \Delta$.\\
if $[\Omega]\Gamma\vdash [\Omega]A \leq [\Omega]\alphahat$, then there are some $\Delta,\Omega'$ such that $\Delta \longmapsto \Omega'$, $\Omega \longrightarrow \Omega'$ and $\Gamma \vdash A \instr \alphahat \dashv \Delta$.

%TODO:
%	Gamma -> [Omega]Gamma
%	TTB
%	expand
%	[Omega]Gamma defn.
%	Sigma -> <rho; tau>

By rule induction on declarative subtyping (TODO: expand)
\begin{tabbing}
Case \=$A = 1$\\
\la{initial1}$[\Omega]\Gamma \vdash [\Omega]\alphahat \leq [\Omega]A$ \` Given.\\
\la{initial2}$[\Omega]\Gamma \vdash [\Omega]\alphahat \leq [\Omega]1$ \` As $A = 1$\\
\la{initial3}$[\Omega]\Gamma \vdash [\Omega]\alphahat \leq 1$ \` By definition of $\Omega$\\
\la{alpharel}$[\Omega]\alphahat = 1$ \` $\Omega$ predicative and by inversion of rule $\st$Unit on \ref{initial3}.\\
\>Want to find $\Delta$ such that $\Gamma \vdash \alphahat \instl 1 \dashv \Delta$.\\
\la{bnd}$\Gamma[\bound{\sigma_l}{\alphahat}{\_}] \vdash \sigma_l \sigbndl 1 \dashv \Theta$ \` By lem. 10 on $\Gamma \ctxmapto \Omega$ and \ref{alpharel}\\
\> WTS: $\Theta[\alphahat\st\sigma_u] \vdash \sigma_u \lub 1 = \pair{\rho}{1} \dashv \Theta'$\\
\>Case \=on $\sigma_u$\\
\>\>Case \=$\sigma_u = \pair{\rho}{\tau_u}$\\
\>\>\la{bnd2}$\Theta \ctxmapto \Omega$ \` Lem. 10 on \ref{bnd}\\
\>\>\la{abnd}$\Theta\vdash [\Omega]\alphahat \sigbndr \pair{\rho}{\tau_u} \dashv\Theta'$ \` Lem. 10 on \ref{bnd2}, n.t. $\Theta'\ctxmapto\Omega$\\
\>\>\la{bnder}$\Theta''\vdash[\Omega]\alphahat\st\tau_u \dashv\Theta'$ \` Lemma 7 on \ref{abnd}\\
\>\>\la{rep}$\Theta''\vdash1 \st \tau_u \dashv\Theta'$ \` As $[\Omega]\alphahat = 1$\\
\>\>\>$\tau_u = 1$ \` As $\tau_u$ a monotype, the only rule that can apply is $\st$Unit.\\
\>\>\la{c1}$\Theta \vdash \pair{\rho}{1} \lub 1 = \pair{\rho}{1}\dashv\Theta'$ \` By lemma 15 on \ref{rep}\\
\>\>\la{ext}$\Theta'\ctxmapto\Omega$ \` By lemma 10 on \ref{bnd2}\\
\>\>Case \=$\sigma_u = \pair{\rho}{\top}$\\
\>\>\la{c2}$\Theta[\alphahat \st \sigma_u] \vdash \pair{\rho}{\top} \lub 1 = \pair{\rho}{1} \dashv \Theta$ \` By lem. 16.\\
\>\>Case \=$\sigma_u = \ldots;\bot$\\
\>\>\la{ctra1}$\Theta \vdash [\Omega]\alphahat \sigbndr \pair{\rho}{\bot} \dashv\Theta'$\\
\>\>\>$\Theta''\vdash [\Omega]\alphahat \sigbndr \bot \dashv \Theta'$ \` Lem. 17 on \ref{ctra1}\\
\>\>\la{ctra}Contradiction, no rule exists\\
\la{lub}$\Theta[\alphahat\st\sigma_u] \vdash \sigma_u \lub 1 = \pair{\rho}{1} \dashv \Theta'$ \` By \ref{c1}, \ref{c2}, \ref{ctra}\\
\>$\Gamma[\bound{\sigma_l}{\alphahat}{\sigma_t}]\vdash \alphahat \instl 1 \dashv \Theta'[\bound{\_}{\alphahat}{\pair{\rho}{1}}]$ \` By InstLAbs on \ref{bnd}, \ref{lub}\\
\>Let $\Delta = \Theta'[\alphahat \st \sigma_u']$\\
\>Let $\Omega' = \Omega$\\
\> $\Omega \longrightarrow \Omega'$ \` By Dunfield Lem. 20 (reflexivity).\\
\> WTS: $\Delta \ctxmapto \Omega$\\
\la{thd} $\Theta' = \Theta_u,\bound{\sigma_b}{\alphahat}{\sigma_u},\Theta_l$ 	\` By defn. of $\Theta'$\\
\> $\Delta = \Theta_u,\bound{\sigma_b}{\alphahat}{\sigma_u'},\Theta_l$ 	\` By defn. of $\Delta$\\
\> $\Omega = \Omega_u,\alphahat = 1,\Omega_l$							\` By defn. of $\Omega$ and $[\Omega]\alphahat=1$\\
\la{l101} $\Theta_l \ctxmapto \Omega_l$ 										\` Lem. 10 on \ref{ext} and \ref{thd}\\
\la{l102} $\Theta_u \vdash \sigma_b \sigbndl 1 \dashv \Theta_u'$ 				\` \emph{ibid}\\
\la{l103} $\Theta_u \vdash 1 \sigbndr \sigma_u \dashv \Theta_u''$ 				\` \emph{ibid}\\
\la{l104} $\Theta_u''\ctxmapto\Delta$ 											\` \emph{ibid}\\
\la{l105} $\Theta_u'\ctxmapto\Delta$ 											\` \emph{ibid}\\
 WTS: $\Theta_u \vdash 1 \sigbndr \pair{\rho}{1} \dashv \Theta_u''$\\
\la{unit} $\Theta_u'' \vdash 1 \st 1 \dashv \Theta_u''$ 						\` by $\st$Unit\\
\la{fn} $\Theta_u \vdash 1 \sigbndr \rho,\top \dashv\Theta_u''$				\` By Lem. 14 on \ref{unit} and \ref{l103}\\
\la{finally} $\Theta_u \vdash 1 \sigbndr \sigma_u' \dashv \Theta_u''$ 			\` By Lem. 12 on \ref{unit} and \ref{fn}\\
\> $\Theta' \ctxmapto \Omega$ \` By Lemma 11 on \ref{finally}, \ref{l101}, \ref{l102}, \ref{l104}, \ref{l105}\\
Case \=$A = \betahat$\resla\\
\>$\alphahat \neq \betahat$ 											\` $\alphahat \not\in FV(A)$\\
\la{st} $[\Omega]\Gamma \vdash [\Omega]\alphahat \leq [\Omega]\betahat$ 		\` $A = \betahat$\\
\la{t1} $[\Omega]\alphahat = \tau_1$ 										\` $\Omega$ predicative\\
\la{t2} $[\Omega]\betahat = \tau_2$ 											\` $\Omega$ predicative\\
\la{abs} $\Gamma \vdash \tau_1 \leq \tau_2$ 									\` Substituting \ref{t1} and \ref{t2} into \ref{st}\\
\> Let $\Omega' = \Omega$\\
\> $\Omega' \longrightarrow \Omega$ 									\` Dunfield Lem. 20, reflexivity.\\
\> Case \=on $\alphahat$ left or right of $\betahat$\\
\>\>Case \=$\Gamma = (\Gamma_0,\alphahat,\Gamma_1,\bound{\sigma_l}{\betahat}{\sigma_t},\Gamma_2)$\\
\>\>\la{b1}$\Gamma_0,\alphahat,\Gamma_1 \vdash \tau_2 \sigbndr \sigma_t$		\` Lem. 10 on $\Gamma \mapsto \Omega$\\
\>\>\la{b2}$\Gamma_0,\alphahat,\Gamma_1 \vdash \tau_1 \sigbndr \sigma_t$		\` Lem. 8 on \ref{abs}\\
\>\>\la{ir}$\Gamma_0,\alphahat,\Gamma_1 \vdash \alphahat \siginstl \sigma_t \dashv \Theta$	\` Lem. 1 on \ref{b2}\\
\>\>\la{basis}$\Gamma_0,\alphahat,\Gamma_1,\betahat,\Gamma_2 \vdash \alphahat \siginstl \sigma_t \dashv \Theta,\bound{\pair{\{r\}}{c}}{\betahat}{\sigma_t},\Gamma_2$	\` Lem. 9 on \ref{ir}\\
\>\>\>$\Gamma_0,\alphahat,\Gamma_1,\betahat,\Gamma_2 \vdash \alphahat \instl \betahat \dashv \Theta,\bound{\pair{\{\alphahat,r\}}{c}}{\betahat}{\sigma_t},\Gamma_2$	\` InstLReach on \ref{basis}\\
\>\>\>$\Omega' = \Omega, \Delta = \Theta;\bound{\pair{\{\alphahat,r\}}{c}}{\betahat}{\sigma_t};\Gamma_2$\\
\>\>\>WTS: $\Theta,\bound{\pair{\{\alphahat,r\}}{c}}{\betahat}{\sigma_t},\Gamma_2 \ctxmapto \Omega_1,\betahat=\tau_2,\Omega_2$\\
\>\>\la{rel}$\Theta,\bound{\sigma_l}{\betahat}{\sigma_t},\Gamma_2 \ctxmapto \Omega_1,\betahat = \tau_2,\Omega_2$ \` By lem. 1 on \ref{b2}\\
\>\>\la{tot10} $\Gamma_2 \ctxmapto \Omega_2$ 										\` Lem. 10 on \ref{rel}\\
\>\>\la{l1021} $\Theta \vdash \sigma_l \sigbndl \tau_2 \dashv \Theta'$ 			\` \emph{ibid}\\
\>\>\> $\Theta \vdash \tau_2 \sigbndr \sigma_t \dashv \Theta''$ 		\` \emph{ibid}\\
\>\>\> $\Theta''\ctxmapto\Omega$ 											\` \emph{ibid}\\
\>\>\la{thp} $\Theta'\ctxmapto\Omega$ 											\` \emph{ibid}\\
\>\>\> WTS: $\Theta \vdash \pair{\{\alphahat,r\}}{c} \sigbndl \tau_2 \vdash \Theta_f$ and $\Theta_f \ctxmapto \Omega$\\
\>\>\la{ihp} $[\Omega]\Theta\vdash [\Omega]\alphahat \leq \tau_2$ 			\` By lemma 18 on \ref{abs}, \ref{thp}, and $\Gamma \ctxmapto \Omega$ \\
\>\>\la{instlb} $\Theta \vdash \alphahat \instl \tau_2 \dashv \Theta_1$ 			\` By IH on \ref{ihp}.\\
\>\>\la{th1mt} $\Theta_1 \ctxmapto \Omega$												\` \emph{ibid}\\
\>\>\la{finth} $\Theta_1 \vdash \pair{\{r\}}{c} \sigbndl \tau_2 \dashv \Theta_f$ \` By lemma 21 on \ref{th1mt}, \ref{l1021}, \ref{ir} and lemma 22 on \ref{instlb}\\
\>\>\la{done} $\Theta \vdash \pair{\{\alphahat,r\}}{c} \sigbndl \tau_2 \vdash \Theta_f$		\` By BndLExt on \ref{finth} and \ref{instlb}\\
\>\>\> $\Theta,\bound{\pair{\{\alphahat,r\}}{c}}{\betahat}{\sigma_2},\Gamma_2 \ctxmapto \Omega_1,\betahat=\tau_2,\Omega_2$ \` By Lem. 11 on \ref{done} and \ref{tot10}\\
\>\>Case \=$\Gamma = (\Gamma_0;\betahat;\Gamma_1;\bound{\sigma_l}{\alphahat}{\sigma_t};\Gamma_2)$\\
\>\>\la{2b1}$\Gamma_0,\betahat,\Gamma_1 \vdash \sigma_l \sigbndl \tau_1$		\` Lem. 10 on $\Gamma \mapsto \Omega$\\
\>\>\la{2b3}$\Gamma_0,\betahat,\Gamma_1 \vdash \sigma_l \sigbndl \tau_2$		\` Lem. 23 on \ref{2b1}\\
\>\>\la{2ir}$\Gamma_0,\betahat,\Gamma_1 \vdash \sigma_l \siginstr \betahat \dashv \Theta$	\` Lem. 2 on \ref{2b3}\\
\>\>\la{2basis}$\Gamma_0,\betahat,\Gamma_1,\alphahat,\Gamma_2 \vdash \sigma_l \siginstr \betahat \dashv \Theta,\bound{\sigma_l}{\alphahat}{\pair{\{r\}}{c}},\Gamma_2$	\` Lem. 24 on \ref{2ir}\\
\>\>\>$\Gamma_0,\alphahat,\Gamma_1,\betahat,\Gamma_2 \vdash \alphahat \instl \betahat \dashv \Theta,\bound{\sigma_l}{\alphahat}{\pair{\{\betahat,r\}}{c}},\Gamma_2$	\` InstLVar on \ref{2basis}\\
\>\>\>$\Delta = \Theta,\bound{\sigma_l}{\alphahat}{\pair{\{\betahat,r\}}{c}},\Gamma_2$\\
\>\>\>WTS $\Delta \ctxmapto \Omega$\\
\>\>\la{omdef} $\Theta,\bound{\sigma_l}{\alphahat}{\pair{\{r\}}{c}},\Gamma_2 \ctxmapto \Omega_1,\alphahat=\tau_1,\Omega_2$ \` Lem. 2 on \ref{2b3}\\
\>\>\la{tf} $\Gamma_2 \ctxmapto \Omega_2$ 										\` Lem. 10 on \ref{omdef}\\
\>\>\> $\Theta \vdash \sigma_l \sigbndl \tau_2 \dashv \Theta'$ 			\` \emph{ibid}\\
\>\>\la{thm} $\Theta \vdash \tau_2 \sigbndr \sigma_t \dashv \Theta''$ 		\` \emph{ibid}\\
\>\>\la{thpm} $\Theta''\ctxmapto\Omega$ 											\` \emph{ibid}\\
\>\>\> $\Theta'\ctxmapto\Omega$ 											\` \emph{ibid}\\
\>\>\>TODO
\end{tabbing}
\end{document}