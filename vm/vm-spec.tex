\documentclass{article}

\usepackage{listings}
\usepackage{amssymb}
\usepackage[margin=.9in]{geometry}
%\usepackage{amsmath}
\usepackage{mathpartir}
\usepackage{mathrsfs}

\lstdefinestyle{custom_lang}{
  xleftmargin=\parindent,
  showstringspaces=false,
  basicstyle=\ttfamily,
  keywordstyle=\bfseries
}

\lstset{emph={%  
    var, def, type, new, self%
    },emphstyle={\bfseries \tt}%
}

\newcommand{\keyw}[1]{\texttt{\textbf{#1}}}

\begin{document}





\section{Virtual Machine Abstract Syntax}

\[
\begin{array}{lll}
\begin{array}{lllr}
e & ::= & x & expressions \\
& | & \keyw{new}~T~\{\keyw{x} \Rightarrow \overline{d}\}&\\
& | & e.m(e) &\\
& | & e.f &\\
& | & e.f = e&\\
& | & \keyw{let}~x=e~\keyw{in}~e &\\
& | & e : T&\\
& | & \mathscr{L} &\\
& | & e.\keyw{match}~\overline{x:T \Rightarrow e}~\keyw{else}~e &\\
&&\\
p & ::= & x & paths \\
& | & p.f &\\
&&\\
v & ::= & x & values \\
&&\\
d & ::= & \keyw{val} \; f : T = v & declarations \\
  & |   & \keyw{var} \; f : T = v &\\
  & |   & \keyw{def} \; m(x:T) : T = e &\\
  & |   & \keyw{type} \; L = T &\\
  & |   & \keyw{delegate} \; T~\keyw{to}~f &\\
&&\\
%p & ::= & x & path \\
%  & | & l & \\
\end{array}
& ~~~~~~
&
\begin{array}{lllr}
T & ::= & c & type \\
& | & \keyw{extag}~c &\\
& | & \keyw{datatag}~\overline{p.L}~c &\\
&&\\
c & ::= & \omega & case ~ type \\
& | & \keyw{case}~\keyw{of}~p.L~\omega &\\
&&\\
\omega & ::= & \{\texttt{x} \Rightarrow \overline{\sigma}\} & structural~type \\
& | & p.L &\\
& | & \omega[L=T] &\\
&&\\
\sigma & ::= & \texttt{val} \; f:T & decl \; type\\
       & |   & \texttt{var} \; f:T \\
       & |   & \texttt{def} \; m:T \rightarrow T \\
       & |   & \texttt{type} \; L = T &\\
       & |   & \texttt{type} \; L &\\
&&\\
\end{array}
\end{array}
\]

Notes

\begin{itemize}

\item Errors (e.g. nothing to do in the default case of a match) can be handled by calling a library function taking a string argument that reports an error (with the given string) and halts (optionally, in the debugger)

\item Should we have a separate $\keyw{newtype} \; L~\keyw{is}~T$ and make the other one $\texttt{type} \; L = T$ so it's explicit when tags are created?  The thing after \keyw{is} would actually be a tagged thing (only).
\end{itemize}


\bibliographystyle{plain}
\bibliography{bib}

\end{document}