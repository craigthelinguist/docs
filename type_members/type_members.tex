\documentclass{llncs}

%\usepackage{listings}
\usepackage{amssymb}
\usepackage[margin=.9in]{geometry}
%\usepackage{amsmath}
\usepackage{mathpartir}

\begin{document}


\section{Type Members}

\subsection{Syntax}



\[
\begin{array}{lll}
\begin{array}{lllr}
e & ::= & x & expression \\
& | & \texttt{var} \; x = \texttt{new} \; \{\texttt{self} \Rightarrow \overline{d}\}; \; e&\\
%& | & \lambda x:T = e\\
%& | & e(e)\\
& | & e.m(e) &\\
& | & e.f &\\
& | & e.f = e&\\
%& | & l &\\
&&\\
v & ::= & x & value \\
&&\\
d & ::= & \texttt{var} \; f : T = e & declaration \\
  & |   & \texttt{def} \; m : T(x:T) = e &\\
  & |   & \texttt{type} \; L : T .. T = T &\\
&&\\
%p & ::= & x & path \\
%  & | & l & \\
&&\\
\Gamma & :: = & \varnothing \; | \; \Gamma, \; x : T & context \\
&&\\
\mu & :: = & \varnothing \; | \; \mu,\; l \mapsto \{\texttt{self} \Rightarrow \overline{d}\} & store \\
%&&\\
%\mu & :: = & \varnothing \; | \; \mu,\; l \mapsto \{\texttt{self} \Rightarrow \overline{d}\} & store
&&\\
\Sigma & :: = & \varnothing \; | \; \Sigma,\; l : T & store \; context \\
\end{array}
& ~~~~~~
&
\begin{array}{lllr}
%T & ::= & \{\texttt{self} \Rightarrow \overline{\sigma}\} & type \\
T & ::= & \{\texttt{self} \Rightarrow \overline{\sigma}\} & type \\
& | & x.L &\\
& | & \top & \\
& | & \bot & \\
&&\\
\sigma & ::= & \texttt{var} \; f:T & decl \; type\\
       & |   & \texttt{def} \; m:T \rightarrow T \\
		 & |   & \texttt{type} \; L : T .. T &\\
&&\\
E & :: = & [\;] & evaluation \; context \\
       & | & E.m(e)\\
       & | & v.m(E)\\
       & | & E.f\\
       & | & E.f = e\\
       & | & v.f = E\\
&&\\
\Delta & :: = & \varnothing \; | \; \Delta,\; x \mapsto l & substitution \; context \\
\end{array}
\end{array}
\]

\subsection{Semantics}
%\subsubsection{Subtyping}

\input{subtype}

\input{wf}

\input{exp}

%\subsubsection{Typing}

\input{typing}

\input{reduction}

T-Var? 

\section{Type Safety}

\subsection{Subject Reduction}


\begin{theorem}[Subject Reduction]
If $\Sigma; \Gamma;  \vdash e : T$, 
   	$\Delta; \; \mu \; | \; e \rightarrow \Delta'; \; \mu' \; | \; e'$ where
	$\Gamma \vdash \mu : \Sigma$ then 
 	$\exists \Gamma', \Sigma', T'$ s.t. 
	$\Sigma'$ extends $\Sigma$,
	$\Gamma'$ extends $\Gamma$,
	$\Sigma'; \Gamma';  \vdash e' : T'$
	and $\Gamma' \vdash T'<:T$.
\end{theorem}
\begin{proof}
By induction on 	$\Delta; \; \mu \; | \; e \rightarrow \Delta'; \; \mu' \; | \; e'$.
\begin{case}[\textsc{R-New}]
%\\ \fbox{
\begin{mathpar}
\inferrule
  {}
  {e := \texttt{var} \; y = \texttt{new} \; \{\texttt{self} \Rightarrow \overline{d}\}; e \\
	e' := e\\
	\mu' = \mu, l \mapsto \{\texttt{self} \Rightarrow \overline{d}\} \\
  	\Delta' = \Delta, y \mapsto l\\
	\Delta; \; \Sigma; \; \Gamma, \texttt{self} : \{\texttt{self} \Rightarrow \overline{\sigma}\} \vdash \overline{d} : \overline{\sigma}\\
	\Sigma; \; \Gamma, y : \{\texttt{self} \Rightarrow \overline{\sigma}\} \vdash e : T}
\end{mathpar}

Let $\Sigma' = \Sigma, l \mapsto \{\texttt{self} \Rightarrow \overline{\sigma}\}$ and 
$\Gamma' = \Gamma, y : \{\texttt{self} \Rightarrow \overline{\sigma}\}$. 
$\therefore \Sigma'; \Gamma';  \vdash e' : T$ and
$\Gamma' \vdash T<:T$ by reflexivity.
%}
\end{case}
\begin{case}[\textsc{R-Meth}]
\begin{mathpar}
\inferrule
  {}
  {e := y.m(z)\\
	e' := [y/\texttt{self},z'/x]e\\
	\mu(\Delta(y)) = \{\texttt{self} \Rightarrow ...,m:T(x:S)=e,...\}\\
   \Delta(z) = l' \\
  	z' \notin dom(\Delta)\\
  	\Delta' = \Delta,z' \mapsto l'}
\end{mathpar}

Let $\Gamma' = \Gamma, z' : S$, $\Sigma' = \Sigma$ and $T' = T$. Since 
$\Sigma; \Gamma;  \vdash y.m(z) : T$, the following hold (\textsc{T-Meth}):
\begin{mathpar}
\inferrule
  {}
  {\Sigma; \; \Gamma \vdash z : S \\
  	\Sigma; \; \Gamma \vdash y : T_0 \\
  	T_0 \ni \texttt{def} \; m:S \rightarrow T}
\end{mathpar}

Since $\Gamma \vdash \mu : \Sigma$ and $\Sigma \; \textbf{wf}$ it
follows that $\Gamma \vdash T : \textbf{wf}$, and thus that 
$\Gamma, z' : S \vdash T : \textbf{wf}$. 

\end{case}
\begin{case}[\textsc{R-Var}]
\end{case}
\begin{case}[\textsc{R-Var}]
\end{case}
\begin{case}[\textsc{R-Assign}]
\end{case}
\begin{case}[\textsc{R-Context}]
\end{case}
\end{proof}

\subsection{Progress}
\begin{theorem}[Progress]
If $\Delta; \Sigma; \Gamma;  \vdash e : T$, then either
\begin{enumerate}
\item e is a value, or
\item $\forall \mu$ s.t.
		   $\Delta; \; \Gamma \vdash \mu : \Sigma$,
         $\exists e', \mu', \Delta'$ s.t. 
         $\Delta; \; \mu \; | \; e \rightarrow \Delta'; \; \mu' \; | \; e'$
\end{enumerate}
\end{theorem}

\end{document}