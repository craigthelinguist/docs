\documentclass{llncs}

\usepackage{listings}
\usepackage{amssymb}
\usepackage[margin=.9in]{geometry}
\usepackage{amsmath}
%\usepackage{amsthm}
\usepackage{mathpartir}
\usepackage{color,soul}


\newtheorem{subcase}{SubCase}
\numberwithin{subcase}{case}
\numberwithin{case}{theorem}
\numberwithin{case}{lemma}




\lstdefinestyle{custom_lang}{
  xleftmargin=\parindent,
  showstringspaces=false,
  basicstyle=\ttfamily,
  keywordstyle=\bfseries
}

\lstset{emph={%  
    val, def, type, new, z%
    },emphstyle={\bfseries \tt}%
}

\begin{document}

\section{Syntax}

\begin{figure}[h]
\[
\begin{array}{lll}
\begin{array}{lllr}
e & ::= & x & expression \\
& | & \texttt{new} \; \{z \Rightarrow \overline{d}\}&\\
%& | & \lambda x:T = e\\
%& | & e(e)\\
& | & e.m_T(e) &\\
& | & e.f &\\
%& | & e.f = e&\\
& | & e \unlhd T&\\
& | & l &\\
&&\\
p & ::= & x & paths \\
& | & l &\\
& | & p.f &\\
& | & p \unlhd T &\\
&&\\
v & ::= & l & value \\
& | & v.f &\\
& | & v \unlhd T &\\
&&\\
d & ::= & \texttt{val} \; f : T = p & declaration \\
  & |   & \texttt{def} \; m(x:T) = e : T &\\
  & |   & \texttt{type} \; L : T .. T&\\
&&\\
\Gamma & :: = & \varnothing \; | \; \Gamma,\; x : T & Environment \\
&&\\
A & :: = & \varnothing \; | \; A,\;  <: T & Assumption \; Context \\
 \end{array}
& ~~~~~~
&
\begin{array}{lllr}
%T & ::= & \{\texttt{z} \Rightarrow \overline{\sigma}\} & type \\
T & ::= & \{z \Rightarrow \overline{\sigma}\} & type \\
& | & p.L &\\
%& | & T \wedge T & \\
& | & \top & \\
& | & \bot & \\
&&\\
\sigma & ::= & \texttt{val} \; f:T & decl \; type\\
       & |   & \texttt{def} \; m:T \rightarrow T \\
		 & |   & \texttt{type} \; L : T .. T &\\
&&\\
E & :: = & \bigcirc & eval \; context\\
       & | & E.m(e)\\
       & | & p.m(E)\\
       & | & E.f\\
%       & | & E.f = e\\
%       & | & v.f = E\\
       & | & E \unlhd T\\
&&\\
d_v & ::= & \texttt{val} \; f : T = v & declaration \; value \\
  & |   & \texttt{def} \; m(x:T) = e : T &\\
  & |   & \texttt{type} \; L : T .. T = T &\\
%       & | & \texttt{var} \; x = \texttt{new} \; \{z \Rightarrow \overline{D}\} & eval \; context \\
%&&\\
%D & :: = & \texttt{val} \; f : T = E & decl \; eval \; context \\
%  & |   & \texttt{def} \; m(x:T) = e : T &\\
%  & |   & \texttt{type} \; L : T .. T &\\
%&&\\
%K & :: = & \varnothing \; | \; K, \; E & evaluation \; stack \\
%\Delta & :: = & \varnothing \; | \; \Delta,\; x \mapsto l & substitution \; context \\
%&&\\
%\Sigma & :: = & \varnothing \; | \; \Sigma,\; l : T & store \; context \\
%&&\\
%p & ::= & x & path \\
%  & | & l & \\
&&\\
\mu & :: = & \varnothing \; | \; \mu,\; l \mapsto \{z \Rightarrow \overline{d}\} & store \\
\Sigma & :: = & \varnothing \; | \; \Sigma,\; l : \{\texttt{z} \Rightarrow \overline{\sigma}\} & store \; type \\
\end{array}
\end{array}
\]
\caption{Syntax}
\label{f:syntax}
\end{figure}


%\begin{figure}[h]
%\begin{mathpar}
%\end{mathpar}
%\caption{Declaration Path Function}
%\label{f:path}
%\end{figure}
%\begin{figure}[h]
%\begin{mathpar}
%\inferrule
%  {}
%  {narrow(x) = x \\ narrow(v \unlhd T) = narrow(v)}
%\end{mathpar}
%\caption{Narrow Function}
%\label{f:narrow}
%\end{figure}

\newpage

\section{Semantics}

%\begin{figure}[h]
%\hfill \fbox{$\mu; \Sigma \vdash v \leadsto l$}
%\begin{mathpar}
%\inferrule
%  {}
%  {\mu; \Sigma \vdash l \leadsto l }
%  \quad (\textsc {P-Loc})
%	\and
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v'}
%  {\mu; \Sigma \vdash v \unlhd T \leadsto v' \unlhd T}
%  \quad (\textsc {L-Type})
%	\and
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v' \\
%   \mu; \Sigma \vdash v' \leadsto_{f} v_f}
%  {\mu; \Sigma \vdash v.f \leadsto v_f}
%  \quad (\textsc {L-Path})
%\end{mathpar}
%\hfill \fbox{$\mu; \Sigma \vdash d_v \leadsto d$}
%\begin{mathpar}
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v'}
%  {\mu; \Sigma \vdash \texttt{val} \; f : T = v \leadsto \texttt{def} \; m : S \rightarrow T}
%  \quad (\textsc {L-Val})
%	\and
%\inferrule
%  {}
%  {\mu; \Sigma \vdash \texttt{def} \; m : S(x:T) = e \leadsto \texttt{def} \; m(x:S) = e : T}
%  \quad (\textsc {L-Def})
%	\and
%\inferrule
%  {}
%  {\mu; \Sigma \vdash \texttt{type} \; L : S .. U \leadsto \texttt{type} \; L : S .. U}
%  \quad (\textsc {L-Type})
%\end{mathpar}
%\caption{Path Leads-to Judgement}
%\label{f:path}
%\end{figure}

%\begin{figure}[h]
%\hfill \fbox{$\mu; \Sigma \vdash v \leadsto_{f} v$}
%\begin{mathpar}
%\inferrule
%  {}
%  {\mu; \Sigma \vdash l \leadsto l }
%  \quad (\textsc {P-Loc})
%	\and
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v'}
%  {\mu; \Sigma \vdash v \unlhd T \leadsto v' \unlhd T}
%  \quad (\textsc {L-Type})
%	\and
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v' \\
%   \mu; \Sigma \vdash v' \leadsto_{f} v_f}
%  {\mu; \Sigma \vdash v.f \leadsto v_f}
%  \quad (\textsc {L-Path})
%\end{mathpar}
%\caption{Path Leads-to Judgement}
%\label{f:path}
%\end{figure}
%
%\newpage

\begin{figure}[h]
\hfill \fbox{$\mu; \Sigma \vdash v_1 \leadsto_{f} v_2$}
\begin{mathpar}
\inferrule
  {\mu(l) = \{z \Rightarrow ..., \texttt{val} \; f : T = v, ...\}}
  {\mu; \Sigma \vdash l \leadsto_{f} v \unlhd T}
  \quad (\textsc {L\textsubscript{$f$}-Loc})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{f} v_2 \\
  	T \neq p.L \\
  	\varnothing; \Sigma; \varnothing \vdash T \prec_z \overline{\sigma} \\
  	\texttt{val} \; f:T' \in \overline{\sigma}}
  {\mu; \Sigma \vdash v_1 \unlhd T \leadsto_{f} v_2 \unlhd T'}
  \quad (\textsc {L\textsubscript{$f$}-Type})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{f} v_2 \\
  	\varnothing; \Sigma; \varnothing \vdash v_1 : T' \\
  	T' \neq p.L \\
  	\varnothing; \Sigma; \varnothing \vdash p \ni \texttt{type} \; L : S .. U \\\\
  	\varnothing; \Sigma; \varnothing \vdash S \prec_z \overline{\sigma}_S \\
  	\texttt{val} \; f:T_S \in \overline{\sigma}_S \\
  	\varnothing; \Sigma; \varnothing \vdash U \prec_z \overline{\sigma}_U \\
  	\texttt{val} \; f:T_U \in \overline{\sigma}_U}
  {\mu; \Sigma \vdash v_1 \unlhd p.L \leadsto_{f} v_2 \unlhd T_S \unlhd T_U}
  \quad (\textsc {L\textsubscript{$f$}-Type-Select-Lower})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{f} v_2 \\
  	\varnothing; \Sigma; \varnothing \vdash v_1 : p.L}
  {\mu; \Sigma \vdash v_1 \unlhd p.L \leadsto_{f} v_2}
  \quad (\textsc {L\textsubscript{$f$}-Type-Select-Refl})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{f_1} v_2 \\
  	\mu; \Sigma \vdash v_2 \leadsto_{f_2} v_3}
  {\mu; \Sigma \vdash v_1.f_1 \leadsto_{f_2} v3}
  \quad (\textsc {L\textsubscript{$f$}-Field})
\end{mathpar}
\caption{Field Leadsto Judgement}
\label{f:path_meth}
\end{figure}

\begin{figure}[h]
\hfill \fbox{$\Sigma \vdash v \leadsto_{\sigma} \overline{\sigma}_0, ..., \overline{\sigma}_i$}
\begin{mathpar}
\inferrule
  {\varnothing; \Sigma; \varnothing \vdash l : \overline{\sigma}}
  {\Sigma \vdash l \leadsto_{\sigma} \varnothing, \overline{\sigma}}
  \quad (\textsc {L\textsubscript{$\sigma$}-Loc})
	\and
\inferrule
  {\Sigma \vdash v \leadsto_{\sigma} \overline{\sigma}_0, ..., \overline{\sigma}_i \\
  	T \neq p.L \\
  	\varnothing; \Sigma; \varnothing \vdash T \prec_z \overline{\sigma}}
  {\Sigma \vdash v \unlhd T \leadsto_{\sigma} \overline{\sigma}_0, ..., \overline{\sigma}_i, \overline{\sigma}}
  \quad (\textsc {L\textsubscript{$\sigma$}-Type})
	\and
\inferrule
  {\Sigma \vdash v \leadsto_{\sigma} \overline{\sigma}_0, ..., \overline{\sigma}_i \\
  	\varnothing; \Sigma; \varnothing \vdash v : T' \\
  	T' \neq p.L \\\\
  	\varnothing; \Sigma; \varnothing \vdash p \ni \texttt{type} \; L : S .. U \\
  	\varnothing; \Sigma; \varnothing \vdash S \prec_z \overline{\sigma}_S\\
  	\varnothing; \Sigma; \varnothing \vdash U \prec_z \overline{\sigma}_U}
  {\Sigma \vdash v \unlhd p.L \leadsto_{\sigma} \overline{\sigma}_0, ..., \overline{\sigma}_i, \overline{\sigma}_S, \overline{\sigma}_U}
  \quad (\textsc {L\textsubscript{$\sigma$}-Type-Select-Lower})
	\and
\inferrule
  {\Sigma \vdash v \leadsto_{\sigma} \overline{\sigma}_0, ..., \overline{\sigma}_i \\
  	\varnothing; \Sigma; \varnothing \vdash v : p.L}
  {\Sigma \vdash v \unlhd p.L \leadsto_{\sigma} \overline{\sigma}_0, ..., \overline{\sigma}_i}
  \quad (\textsc {L\textsubscript{$\sigma$}-Type-Select-Refl})
	\and
\inferrule
  {\mu; \Sigma \vdash v \leadsto_{\sigma} \sigma \\
  	\varnothing; \Sigma; \varnothing \vdash T \prec_z \overline{\sigma} \\
  	\texttt{def} \; m : S \rightarrow T \in \overline{\sigma}}
  {\mu; \Sigma \vdash v \unlhd T \leadsto_{\sigma} \sigma \unlhd (\texttt{def} \; m : S \rightarrow T)}
  \quad (\textsc {L\textsubscript{$\sigma$}-Field})
\end{mathpar}
\caption{Field Leadsto Judgement}
\label{f:path_field}
\end{figure}

\begin{figure}[h]
\hfill \fbox{$\mu; \Sigma \vdash v \leadsto_{m} \sigma_0, ..., \sigma_i$}
\begin{mathpar}
\inferrule
  {\mu(l) = \{z \Rightarrow ..., \texttt{def} \; m(x:S)=e:T, ...\}}
  {\mu; \Sigma \vdash l \leadsto_{m} \texttt{def} \; m : S \rightarrow T}
  \quad (\textsc {L\textsubscript{$m$}-Loc})
	\and
\inferrule
  {\mu; \Sigma \vdash v \leadsto_{m} \sigma \\
  	\varnothing; \Sigma; \varnothing \vdash T \prec_z \overline{\sigma} \\
  	\texttt{def} \; m : S \rightarrow U \in \overline{\sigma}}
  {\mu; \Sigma \vdash v \unlhd T \leadsto_{m} \sigma \unlhd (\texttt{def} \; m : S \rightarrow U)}
  \quad (\textsc {L\textsubscript{$m$}-Type})
	\and
\inferrule
  {\mu; \Sigma \vdash v \leadsto_{m} \sigma \\
  	\varnothing; \Sigma; \varnothing \vdash T \prec_z \overline{\sigma} \\
  	\texttt{def} \; m : S \rightarrow T \in \overline{\sigma}}
  {\mu; \Sigma \vdash v \unlhd T \leadsto_{m} \sigma \unlhd (\texttt{def} \; m : S \rightarrow T)}
  \quad (\textsc {L\textsubscript{$m$}-Field})
\end{mathpar}
\caption{Field Leadsto Judgement}
\label{f:path_field}
\end{figure}

\begin{figure}[h]
\hfill \fbox{$v \leadsto_{\unlhd} l$}
\begin{mathpar}
\inferrule
  {}
  {l \leadsto_{\unlhd} l}
  \quad (\textsc {L\textsubscript{$\unlhd$}-Loc})
	\and
\inferrule
  {v \leadsto_{\unlhd} v'}
  {v \unlhd T \leadsto_{\unlhd} v'}
  \quad (\textsc {L\textsubscript{$\unlhd$}-Type})
	\and
\inferrule
  {v \leadsto_{\unlhd} v'}
  {v.f \leadsto_{\unlhd} v'.f}
  \quad (\textsc {L\textsubscript{$\unlhd$}-Field})
\end{mathpar}
\caption{Cast Leadsto Judgement}
\label{f:path_cast}
\end{figure}

\newpage

\input{subtype}

\input{wf}

\input{exp}

%\subsubsection{Typing}

\input{typing}

\input{reduction}

\bibliographystyle{plain}
\bibliography{bib}

\end{document} 
