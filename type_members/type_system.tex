\documentclass{llncs}

\usepackage{listings}
\usepackage{amssymb}
\usepackage[margin=.9in]{geometry}
\usepackage{amsmath}
%\usepackage{amsthm}
\usepackage{mathpartir}
\usepackage{color,soul}


\newtheorem{subcase}{SubCase}
\numberwithin{subcase}{case}
\numberwithin{case}{theorem}
\numberwithin{case}{lemma}




\lstdefinestyle{custom_lang}{
  xleftmargin=\parindent,
  showstringspaces=false,
  basicstyle=\ttfamily,
  keywordstyle=\bfseries
}

\lstset{emph={%  
    val, def, type, new, z%
    },emphstyle={\bfseries \tt}%
}

\begin{document}

\section{Syntax}

\begin{figure}[h]
\[
\begin{array}{lll}
\begin{array}{lllr}
e & ::= & x & expression \\
& | & \texttt{new} \; \{z \Rightarrow \overline{d}\}&\\
%& | & \lambda x:T = e\\
%& | & e(e)\\
& | & e.m_T(e) &\\
& | & e.f &\\
%& | & e.f = e&\\
& | & e \unlhd T&\\
& | & l &\\
&&\\
p & ::= & x & paths \\
& | & l &\\
& | & p.f &\\
& | & p \unlhd T &\\
&&\\
v & ::= & l & value \\
& | & v.f &\\
& | & v \unlhd T &\\
&&\\
d & ::= & \texttt{val} \; f : T = p & declaration \\
  & |   & \texttt{def} \; m(x:T) = e : T &\\
  & |   & \texttt{type} \; L : T .. T&\\
&&\\
\Gamma & :: = & \varnothing \; | \; \Gamma,\; x : T & Environment \\
&&\\
A & :: = & \varnothing \; | \; A,\;  <: T & Assumption \; Context \\
 \end{array}
& ~~~~~~
&
\begin{array}{lllr}
%T & ::= & \{\texttt{z} \Rightarrow \overline{\sigma}\} & type \\
T & ::= & \{z \Rightarrow \overline{\sigma}\} & type \\
& | & p.L &\\
%& | & T \wedge T & \\
& | & \top & \\
& | & \bot & \\
&&\\
\sigma & ::= & \texttt{val} \; f:T & decl \; type\\
       & |   & \texttt{def} \; m:T \rightarrow T \\
		 & |   & \texttt{type} \; L : T .. T &\\
&&\\
E & :: = & \bigcirc & eval \; context\\
       & | & E.m(e)\\
       & | & p.m(E)\\
       & | & E.f\\
%       & | & E.f = e\\
%       & | & v.f = E\\
       & | & E \unlhd T\\
&&\\
d_v & ::= & \texttt{val} \; f : T = v & declaration \; value \\
  & |   & \texttt{def} \; m(x:T) = e : T &\\
  & |   & \texttt{type} \; L : T .. T = T &\\
%       & | & \texttt{var} \; x = \texttt{new} \; \{z \Rightarrow \overline{D}\} & eval \; context \\
%&&\\
%D & :: = & \texttt{val} \; f : T = E & decl \; eval \; context \\
%  & |   & \texttt{def} \; m(x:T) = e : T &\\
%  & |   & \texttt{type} \; L : T .. T &\\
%&&\\
%K & :: = & \varnothing \; | \; K, \; E & evaluation \; stack \\
%\Delta & :: = & \varnothing \; | \; \Delta,\; x \mapsto l & substitution \; context \\
%&&\\
%\Sigma & :: = & \varnothing \; | \; \Sigma,\; l : T & store \; context \\
%&&\\
%p & ::= & x & path \\
%  & | & l & \\
&&\\
\mu & :: = & \varnothing \; | \; \mu,\; l \mapsto \{z \Rightarrow \overline{d}\} & store \\
\Sigma & :: = & \varnothing \; | \; \Sigma,\; l : \{\texttt{z} \Rightarrow \overline{\sigma}\} & store \; type \\
\end{array}
\end{array}
\]
\caption{Syntax}
\label{f:syntax}
\end{figure}


\begin{figure}[h]
\begin{mathpar}
\inferrule
  {}
  {p \equiv p}
  \quad (\textsc{Eq-Refl})
  \and
\inferrule
  {p_1 \equiv p_2}
  {p_2 \equiv p_1}
  \quad (\textsc{Eq-Sym})
  \and
\inferrule
  {p_1 \equiv p_2}
  {p_1 \equiv p_2 \unlhd T}
  \quad (\textsc{Eq-Path})
  \and
\inferrule
  {p_1 \equiv p_2}
  {p_1.f \equiv p_2.f}
  \quad (\textsc{Eq-Field})
\end{mathpar}
\caption{Path Equivalence}
\label{f:path_equiv}
\end{figure}


\begin{figure}[h]
\begin{mathpar}
\inferrule
  {}
  {\{z \Rightarrow \overline{\sigma}\} \equiv \{z \Rightarrow \overline{\sigma}\}}
  \quad (\textsc{Eq-Rec})
  \and
\inferrule
  {p_1 \equiv p_2}
  {p_1.L \equiv p_2.L}
  \quad (\textsc{Eq-Select})
  \and
\inferrule
  {}
  {\top \equiv \top}
  \quad (\textsc{Eq-Top})
  \and
\inferrule
  {}
  {\bot \equiv \bot}
  \quad (\textsc{Eq-Bottom})
\end{mathpar}
\caption{Type Equivalence}
\label{f:type_equiv}
\end{figure}

%\begin{figure}[h]
%\begin{mathpar}
%\end{mathpar}
%\caption{Declaration Path Function}
%\label{f:path}
%\end{figure}
%\begin{figure}[h]
%\begin{mathpar}
%\inferrule
%  {}
%  {narrow(x) = x \\ narrow(v \unlhd T) = narrow(v)}
%\end{mathpar}
%\caption{Narrow Function}
%\label{f:narrow}
%\end{figure}

\newpage

\section{Semantics}

%\begin{figure}[h]
%\hfill \fbox{$\mu; \Sigma \vdash v \leadsto l$}
%\begin{mathpar}
%\inferrule
%  {}
%  {\mu; \Sigma \vdash l \leadsto l }
%  \quad (\textsc {P-Loc})
%	\and
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v'}
%  {\mu; \Sigma \vdash v \unlhd T \leadsto v' \unlhd T}
%  \quad (\textsc {L-Type})
%	\and
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v' \\
%   \mu; \Sigma \vdash v' \leadsto_{f} v_f}
%  {\mu; \Sigma \vdash v.f \leadsto v_f}
%  \quad (\textsc {L-Path})
%\end{mathpar}
%\hfill \fbox{$\mu; \Sigma \vdash d_v \leadsto d$}
%\begin{mathpar}
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v'}
%  {\mu; \Sigma \vdash \texttt{val} \; f : T = v \leadsto \texttt{def} \; m : S \rightarrow T}
%  \quad (\textsc {L-Val})
%	\and
%\inferrule
%  {}
%  {\mu; \Sigma \vdash \texttt{def} \; m : S(x:T) = e \leadsto \texttt{def} \; m(x:S) = e : T}
%  \quad (\textsc {L-Def})
%	\and
%\inferrule
%  {}
%  {\mu; \Sigma \vdash \texttt{type} \; L : S .. U \leadsto \texttt{type} \; L : S .. U}
%  \quad (\textsc {L-Type})
%\end{mathpar}
%\caption{Path Leads-to Judgement}
%\label{f:path}
%\end{figure}

%\begin{figure}[h]
%\hfill \fbox{$\mu; \Sigma \vdash v \leadsto_{f} v$}
%\begin{mathpar}
%\inferrule
%  {}
%  {\mu; \Sigma \vdash l \leadsto l }
%  \quad (\textsc {P-Loc})
%	\and
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v'}
%  {\mu; \Sigma \vdash v \unlhd T \leadsto v' \unlhd T}
%  \quad (\textsc {L-Type})
%	\and
%\inferrule
%  {\mu; \Sigma \vdash v \leadsto v' \\
%   \mu; \Sigma \vdash v' \leadsto_{f} v_f}
%  {\mu; \Sigma \vdash v.f \leadsto v_f}
%  \quad (\textsc {L-Path})
%\end{mathpar}
%\caption{Path Leads-to Judgement}
%\label{f:path}
%\end{figure}
%
%\newpage

\begin{figure}[h]
\hfill \fbox{$\mu; \Sigma \vdash v_1 \leadsto v_2$}
\begin{mathpar}
\inferrule
  {}
  {\mu; \Sigma \vdash l \leadsto l}
  \quad (\textsc {L-Loc})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto v_2 \\
  	\forall p \; L, T \neq p.L}
  {\mu; \Sigma \vdash v_1 \unlhd T \leadsto v_2 \unlhd T}
  \quad (\textsc {L-Type})
	\and
\inferrule
  {\varnothing; \Sigma; \varnothing \vdash v_1 : T \\
  	T \not\equiv p.L \\
  	\varnothing; \Sigma; \varnothing \vdash p \ni \texttt{type} \; L : S .. U \\
  	\mu; \Sigma \vdash v_1 \unlhd S \unlhd U \leadsto v_2}
  {\mu; \Sigma \vdash v_1 \unlhd p.L \leadsto v_2}
  \quad (\textsc {L-Type-Select-Lower})
	\and
\inferrule
  {\varnothing; \Sigma; \varnothing \vdash v_1 : p'.L \\
   p' \equiv p \\
  	\varnothing; \Sigma; \varnothing \vdash p \ni \texttt{type} \; L : S .. U \\
  	\mu; \Sigma \vdash v_1 \unlhd U \leadsto v_2}
  {\mu; \Sigma \vdash v_1 \unlhd p.L \leadsto v_2}
  \quad (\textsc {L-Type-Select-Refl})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{f} v_2}
  {\mu; \Sigma \vdash v_1.f \leadsto v_2}
  \quad (\textsc {L-Field})
\end{mathpar}
\caption{Leadsto Judgement}
\label{f:leadsto}
\end{figure}

\begin{figure}[h]
\hfill \fbox{$\mu; \Sigma \vdash v_1 \leadsto_{f} v_2$}
\begin{mathpar}
\inferrule
  {\mu(l) = \{z \Rightarrow ..., \texttt{val} \; f : T = v, ...\}}
  {\mu; \Sigma \vdash l \leadsto_{f} v \unlhd T}
  \quad (\textsc {L\textsubscript{$f$}-Loc})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{f} v_2 \\
  \texttt{val} \; f:T \in \overline{\sigma}}
  {\mu; \Sigma \vdash v_1 \unlhd \{z \Rightarrow \overline{\sigma}\} \leadsto_{f} v_2 \unlhd T}
  \quad (\textsc {L\textsubscript{$f$}-Type})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \unlhd p.L \leadsto v_2 \\
   \mu; \Sigma \vdash v_2 \leadsto_{f} v_3}
  {\mu; \Sigma \vdash v_1 \unlhd p.L \leadsto_{f} v_3}
  \quad (\textsc {L\textsubscript{$f$}-Type-Select})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{f_1} v_2 \\
  	\mu; \Sigma \vdash v_2 \leadsto_{f_2} v_3}
  {\mu; \Sigma \vdash v_1.f_1 \leadsto_{f_2} v3}
  \quad (\textsc {L\textsubscript{$f$}-Field})
\end{mathpar}
\caption{Field Leadsto Judgement}
\label{f:field_leadsto}
\end{figure}

\begin{figure}[h]
\hfill \fbox{$\mu; \Sigma \vdash v_1 \leadsto_{m} e$}
\begin{mathpar}
\inferrule
  {\mu(l) = \{z \Rightarrow ..., \texttt{def} \; m (x : S) = e : T, ...\}}
  {\mu; \Sigma \vdash l \leadsto_{m} e \unlhd T}
  \quad (\textsc {L\textsubscript{$m$}-Loc})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{m} e \\
  \texttt{def} \; m : S \rightarrow T \in \overline{\sigma}}
  {\mu; \Sigma \vdash v_1 \unlhd \{z \Rightarrow \overline{\sigma}\} \leadsto_{m} e \unlhd T}
  \quad (\textsc {L\textsubscript{$m$}-Type})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \unlhd p.L \leadsto v_2 \\
   \mu; \Sigma \vdash v_2 \leadsto_{m} v_3}
  {\mu; \Sigma \vdash v_1 \unlhd p.L \leadsto_{m} v_3}
  \quad (\textsc {L\textsubscript{$m$}-Type-Select})
	\and
\inferrule
  {\mu; \Sigma \vdash v_1 \leadsto_{f} v_2 \\
  	\mu; \Sigma \vdash v_2 \leadsto_{m} v_3}
  {\mu; \Sigma \vdash v_1.f \leadsto_{m} v3}
  \quad (\textsc {L\textsubscript{$m$}-Field})
\end{mathpar}
\caption{Method Leadsto Judgement}
\label{f:meth_leadsto}
\end{figure}

\newpage

\input{subtype}

\input{wf}

\input{exp}

%\subsubsection{Typing}

\input{typing}

\input{reduction}

\bibliographystyle{plain}
\bibliography{bib}

\end{document} 
